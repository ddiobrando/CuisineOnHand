<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CuisineOnHand: Recipe Generator</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/styles.css') }}?v=1">

</head>
<body>

    <div class="container mt-5">
        <h1>CuisineOnHand: Recipe Generator</h1>
        <form id="recipeForm">
            <div class="form-group">
                <label for="ingredients">Enter Your Ingredients (Make sure you also input the seasonings you have):</label>
                <textarea class="form-control" id="ingredients" rows="3" required></textarea>
            </div>
            <div class="form-group">
                <label for="diet">What kind of diet habit do you have (such as gluten-free, vegan, etc.)?</label>
                <textarea class="form-control" id="diet" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label for="requirement">Do you have any other special requirements? Input here:</label>
                <textarea class="form-control" id="requirement" rows="3"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">Generate a recipe</button>
        </form>

        <br>
        <h3>Recipe:</h3>
        <p id="recipe"></p>
        <h3>Recipe's Title & Summary:</h3>
        <p id="recipe_desc"></p>
        <h3>Calories:</h3>
        <p id="calories"></p>
        <h3>Visual Inspiration (Generated by DALL·E):</h3>
        <img id="generated_photo" src="" alt="Generated Dish by DALL·E" style="max-width: 100%; height: auto;">
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#recipeForm").submit(function (e) {
                e.preventDefault();

                // Show loading text or graphic
                $("#recipe").text("Generating recipe...");
                $("#recipe_desc").text("");
                $("#calories").text("");
                $("#generated_photo").attr("src", "").attr("alt", "Loading image...");

                // Perform the AJAX post request
                $.ajax({
                    type: "POST",
                    url: "/remix",
                    data: {
                        ingredients: $("#ingredients").val(),
                        diet: $("#diet").val(),
                        requirement: $("#requirement").val()
                    },
                    success: function (data) {
                        $("#recipe").html(data.recipe);
                        $("#recipe_desc").html(data.recipe_desc);
                        $("#generated_photo").attr("src", data.photo_url).attr("alt", "Generated Dish Image");

                        // Update the calorie information.
                        if (data.calories) {
                            $("#calories").text(` ${data.calories}`);
                        } else {
                            $("#calories").text("Calorie information is not available.");
                        }
                    },
                    error: function () {
                        $("#recipe").html("Failed to generate recipe. Please try again.");
                        $("#recipe_desc").html("");
                        $("#calories").text("");
                        $("#generated_photo").attr("src", "").attr("alt", "Failed to load image.");
                    }
                });
            });
        });
    </script>
</body>
</html>
